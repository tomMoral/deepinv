<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DPIR method for PnP image deblurring. &mdash; deepinverse 0.1 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/logo.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=2709fde1"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Regularization by Denoising (RED) for Super-Resolution." href="demo_RED_GSPnP_SR.html" />
    <link rel="prev" title="Vanilla PnP for computed tomography (CT)." href="demo_vanilla_PnP.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/deepinv_logolarge.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.physics.html">Physics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.loss.html">Loss</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.optim.html">Optim</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.pnp.html">PnP and RED algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.unfolded.html">Unfolded algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.sampling.html">Sampling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#basics">Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#plug-and-play">Plug-and-Play</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="demo_vanilla_PnP.html">Vanilla PnP for computed tomography (CT).</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">DPIR method for PnP image deblurring.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup-paths-for-data-loading-and-results">Setup paths for data loading and results.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-base-image-datasets-and-degradation-operators">Load base image datasets and degradation operators.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#generate-a-dataset-of-blurred-images-and-load-it">Generate a dataset of blurred images and load it.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#set-up-the-dpir-algorithm-to-solve-the-inverse-problem">Set up the DPIR algorithm to solve the inverse problem.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#evaluate-the-model-on-the-problem">Evaluate the model on the problem.</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="demo_RED_GSPnP_SR.html">Regularization by Denoising (RED) for Super-Resolution.</a></li>
<li class="toctree-l3"><a class="reference internal" href="demo_PnP_custom_optim.html">PnP with custom optimization algorithm (Condat-Vu Primal-Dual)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#sampling">Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#self-supervised-learning">Self-Supervised Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#unfolded">Unfolded</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.notation.html">Math Notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../deepinv.contributing.html">How to Contribute</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">deepinverse</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Examples</a></li>
      <li class="breadcrumb-item active">DPIR method for PnP image deblurring.</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/auto_examples/plug-and-play/demo_PnP_DPIR_deblur.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-plug-and-play-demo-pnp-dpir-deblur-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="dpir-method-for-pnp-image-deblurring">
<span id="sphx-glr-auto-examples-plug-and-play-demo-pnp-dpir-deblur-py"></span><h1>DPIR method for PnP image deblurring.<a class="headerlink" href="#dpir-method-for-pnp-image-deblurring" title="Link to this heading"></a></h1>
<p>This example shows how to use the DPIR method to solve a PnP image deblurring problem. The DPIR method is described in
the following paper:
Zhang, K., Zuo, W., Gu, S., &amp; Zhang, L. (2017).
Learning deep CNN denoiser prior for image restoration.
In Proceedings of the IEEE conference on computer vision and pattern recognition (pp. 3929-3938).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">deepinv</span> <span class="k">as</span> <span class="nn">dinv</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/2.0/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">DataLoader</span></a>
<span class="kn">from</span> <span class="nn">deepinv.models</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">DRUNet</span></a>
<span class="kn">from</span> <span class="nn">deepinv.optim.data_fidelity</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">L2</span></a>
<span class="kn">from</span> <span class="nn">deepinv.optim.prior</span> <span class="kn">import</span> <a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">PnP</span></a>
<span class="kn">from</span> <span class="nn">deepinv.optim.optimizers</span> <span class="kn">import</span> <span class="n">optim_builder</span>
<span class="kn">from</span> <span class="nn">deepinv.training_utils</span> <span class="kn">import</span> <span class="n">test</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">transforms</span>
<span class="kn">from</span> <span class="nn">deepinv.utils.parameters</span> <span class="kn">import</span> <span class="n">get_DPIR_params</span>
<span class="kn">from</span> <span class="nn">deepinv.utils.demo</span> <span class="kn">import</span> <span class="n">load_dataset</span><span class="p">,</span> <span class="n">load_degradation</span>
</pre></div>
</div>
<section id="setup-paths-for-data-loading-and-results">
<h2>Setup paths for data loading and results.<a class="headerlink" href="#setup-paths-for-data-loading-and-results" title="Link to this heading"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BASE_DIR</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.Path" title="pathlib.Path" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class"><span class="n">Path</span></a><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ORIGINAL_DATA_DIR</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BASE_DIR</span></a> <span class="o">/</span> <span class="s2">&quot;datasets&quot;</span>
<a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">DATA_DIR</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BASE_DIR</span></a> <span class="o">/</span> <span class="s2">&quot;measurements&quot;</span>
<a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RESULTS_DIR</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BASE_DIR</span></a> <span class="o">/</span> <span class="s2">&quot;results&quot;</span>
<a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">DEG_DIR</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">BASE_DIR</span></a> <span class="o">/</span> <span class="s2">&quot;degradations&quot;</span>
</pre></div>
</div>
</section>
<section id="load-base-image-datasets-and-degradation-operators">
<h2>Load base image datasets and degradation operators.<a class="headerlink" href="#load-base-image-datasets-and-degradation-operators" title="Link to this heading"></a></h2>
<p>In this example, we use the Set3C dataset and a motion blur kernel from
<a class="reference external" href="https://ieeexplore.ieee.org/abstract/document/5206815/">Levin et al. (2009)</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the global random seed from pytorch to ensure reproducibility of the example.</span>
<a href="https://pytorch.org/docs/2.0/generated/torch.manual_seed.html#torch.manual_seed" title="torch.manual_seed" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span></a><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a> <span class="o">=</span> <span class="n">dinv</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_freer_gpu</span><span class="p">()</span> <span class="k">if</span> <a href="https://pytorch.org/docs/2.0/generated/torch.cuda.is_available.html#torch.cuda.is_available" title="torch.cuda.is_available" class="sphx-glr-backref-module-torch-cuda sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span></a><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span>

<span class="c1"># Set up the variable to fetch dataset and operators.</span>
<a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">method</span></a> <span class="o">=</span> <span class="s2">&quot;DPIR&quot;</span>
<a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_name</span></a> <span class="o">=</span> <span class="s2">&quot;set3c&quot;</span>
<a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">img_size</span></a> <span class="o">=</span> <span class="mi">256</span> <span class="k">if</span> <a href="https://pytorch.org/docs/2.0/generated/torch.cuda.is_available.html#torch.cuda.is_available" title="torch.cuda.is_available" class="sphx-glr-backref-module-torch-cuda sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span></a><span class="p">()</span> <span class="k">else</span> <span class="mi">32</span>
<span class="n">val_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
    <span class="p">[</span><a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">transforms</span><span class="o">.</span><span class="n">CenterCrop</span></a><span class="p">(</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">img_size</span></a><span class="p">),</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()]</span>
<span class="p">)</span>

<span class="c1"># Generate a motion blur operator.</span>
<a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_index</span></a> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># which kernel to chose among the 8 motion kernels from &#39;Levin09.mat&#39;</span>
<a href="https://pytorch.org/docs/2.0/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_torch</span></a> <span class="o">=</span> <span class="n">load_degradation</span><span class="p">(</span>
    <span class="s2">&quot;Levin09.npy&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">DEG_DIR</span></a> <span class="o">/</span> <span class="s2">&quot;kernels&quot;</span><span class="p">,</span> <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_index</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_index</span></a>
<span class="p">)</span>
<a href="https://pytorch.org/docs/2.0/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_torch</span></a> <span class="o">=</span> <a href="https://pytorch.org/docs/2.0/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_torch</span></a><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span>
    <span class="mi">0</span>
<span class="p">)</span>  <span class="c1"># add batch and channel dimensions</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_name</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">ORIGINAL_DATA_DIR</span></a><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">val_transform</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Levin09.npy degradation downloaded in degradations/kernels
Downloading datasets/set3c.zip

  0%|          | 0.00/385k [00:00&lt;?, ?iB/s]
 19%|█▉        | 72.7k/385k [00:00&lt;00:00, 721kiB/s]
 40%|████      | 155k/385k [00:00&lt;00:00, 773kiB/s]
100%|██████████| 385k/385k [00:00&lt;00:00, 1.30MiB/s]
set3c dataset downloaded in datasets
</pre></div>
</div>
</section>
<section id="generate-a-dataset-of-blurred-images-and-load-it">
<h2>Generate a dataset of blurred images and load it.<a class="headerlink" href="#generate-a-dataset-of-blurred-images-and-load-it" title="Link to this heading"></a></h2>
<p>We use the BlurFFT class from the physics module to generate a dataset of blurred images.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3.4/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noise_level_img</span></a> <span class="o">=</span> <span class="mf">0.03</span>  <span class="c1"># Gaussian Noise standard deviation for the degradation</span>
<a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_channels</span></a> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># 3 for color images, 1 for gray-scale images</span>
<span class="n">p</span> <span class="o">=</span> <a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">dinv</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">BlurFFT</span></a><span class="p">(</span>
    <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">img_size</span></a><span class="o">=</span><span class="p">(</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_channels</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">img_size</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">img_size</span></a><span class="p">),</span>
    <span class="nb">filter</span><span class="o">=</span><a href="https://pytorch.org/docs/2.0/tensors.html#torch.Tensor" title="torch.Tensor" class="sphx-glr-backref-module-torch sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">kernel_torch</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="p">,</span>
    <span class="n">noise_model</span><span class="o">=</span><a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">dinv</span><span class="o">.</span><span class="n">physics</span><span class="o">.</span><span class="n">GaussianNoise</span></a><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noise_level_img</span></a><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># Use parallel dataloader if using a GPU to fasten training,</span>
<span class="c1"># otherwise, as all computes are on CPU, use synchronous data loading.</span>
<a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">num_workers</span></a> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <a href="https://pytorch.org/docs/2.0/generated/torch.cuda.is_available.html#torch.cuda.is_available" title="torch.cuda.is_available" class="sphx-glr-backref-module-torch-cuda sphx-glr-backref-type-py-function"><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span></a><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>

<a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_images_max</span></a> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Maximal number of images to restore from the input dataset</span>
<span class="c1"># Generate a dataset in a HDF5 folder in &quot;{dir}/dinv_dataset0.h5&#39;&quot; and load it.</span>
<a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">operation</span></a> <span class="o">=</span> <span class="s2">&quot;deblur&quot;</span>
<a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">measurement_dir</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">DATA_DIR</span></a> <span class="o">/</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_name</span></a> <span class="o">/</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">operation</span></a>
<a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dinv_dataset_path</span></a> <span class="o">=</span> <span class="n">dinv</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">generate_dataset</span><span class="p">(</span>
    <span class="n">train_dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
    <span class="n">test_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">physics</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="p">,</span>
    <span class="n">save_dir</span><span class="o">=</span><a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">measurement_dir</span></a><span class="p">,</span>
    <span class="n">train_datapoints</span><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">n_images_max</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">num_workers</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">num_workers</span></a><span class="p">,</span>
<span class="p">)</span>

<a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">batch_size</span></a> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># batch size for testing. As the number of iterations is fixed, we can use batch_size &gt; 1</span>
<span class="c1"># and restore multiple images in parallel.</span>
<span class="n">dataset</span> <span class="o">=</span> <a href="https://pytorch.org/docs/2.0/data.html#torch.utils.data.Dataset" title="torch.utils.data.Dataset" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">dinv</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">HDF5Dataset</span></a><span class="p">(</span><span class="n">path</span><span class="o">=</span><a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dinv_dataset_path</span></a><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Computing train measurement vectors from base dataset...

  0%|          | 0/2 [00:00&lt;?, ?it/s]
100%|██████████| 2/2 [00:00&lt;00:00, 100.60it/s]
Dataset has been saved in measurements/set3c/deblur
</pre></div>
</div>
</section>
<section id="set-up-the-dpir-algorithm-to-solve-the-inverse-problem">
<h2>Set up the DPIR algorithm to solve the inverse problem.<a class="headerlink" href="#set-up-the-dpir-algorithm-to-solve-the-inverse-problem" title="Link to this heading"></a></h2>
<p>This method is based on half-quadratic splitting (HQS).
The algorithm alternates between a denoising step and a data fidelity step, where
the denoising step is performed by a pretrained denoiser <a class="reference internal" href="../../stubs/deepinv.models.DRUNet.html#deepinv.models.DRUNet" title="deepinv.models.DRUNet"><code class="xref py py-class docutils literal notranslate"><span class="pre">deepinv.models.DRUNet</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># load specific parameters for DPIR</span>
<a href="https://docs.python.org/3.4/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lamb</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma_denoiser</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stepsize</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">max_iter</span></a> <span class="o">=</span> <span class="n">get_DPIR_params</span><span class="p">(</span><a href="https://docs.python.org/3.4/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">noise_level_img</span></a><span class="p">)</span>
<a href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">params_algo</span></a> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stepsize&quot;</span><span class="p">:</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">stepsize</span></a><span class="p">,</span> <span class="s2">&quot;g_param&quot;</span><span class="p">:</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#list" title="builtins.list" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">sigma_denoiser</span></a><span class="p">,</span> <span class="s2">&quot;lambda&quot;</span><span class="p">:</span> <a href="https://docs.python.org/3.4/library/functions.html#float" title="builtins.float" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">lamb</span></a><span class="p">}</span>
<a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">early_stop</span></a> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Do not stop algorithm with convergence criteria</span>

<span class="c1"># Select the data fidelity term</span>
<span class="n">data_fidelity</span> <span class="o">=</span> <a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">L2</span></a><span class="p">()</span>

<span class="c1"># Specify the denoising prior</span>
<span class="n">prior</span> <span class="o">=</span> <a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">PnP</span></a><span class="p">(</span><span class="n">denoiser</span><span class="o">=</span><a href="https://pytorch.org/docs/2.0/generated/torch.nn.Module.html#torch.nn.Module" title="torch.nn.Module" class="sphx-glr-backref-module-torch-nn sphx-glr-backref-type-py-class"><span class="n">DRUNet</span></a><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="s2">&quot;download&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="p">))</span>

<span class="c1"># instantiate the algorithm class to solve the IP problem.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">optim_builder</span><span class="p">(</span>
    <span class="n">iteration</span><span class="o">=</span><span class="s2">&quot;HQS&quot;</span><span class="p">,</span>
    <span class="n">prior</span><span class="o">=</span><span class="n">prior</span><span class="p">,</span>
    <span class="n">data_fidelity</span><span class="o">=</span><span class="n">data_fidelity</span><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">early_stop</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">early_stop</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">max_iter</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">max_iter</span></a><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">params_algo</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/stdtypes.html#dict" title="builtins.dict" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">params_algo</span></a><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Downloading: &quot;https://mycore.core-cloud.net/index.php/s/9EzDqcJxQUJKYul/download?path=%2Fweights&amp;files=drunet_color.pth&quot; to /home/runner/.cache/torch/hub/checkpoints/drunet_color.pth

  0%|          | 0.00/125M [00:00&lt;?, ?B/s]
  0%|          | 120k/125M [00:00&lt;01:59, 1.09MB/s]
  0%|          | 296k/125M [00:00&lt;01:53, 1.14MB/s]
  1%|          | 728k/125M [00:00&lt;00:59, 2.19MB/s]
  1%|          | 1.02M/125M [00:00&lt;00:58, 2.23MB/s]
  1%|          | 1.39M/125M [00:00&lt;00:47, 2.70MB/s]
  1%|▏         | 1.68M/125M [00:00&lt;00:47, 2.70MB/s]
  2%|▏         | 1.99M/125M [00:00&lt;00:50, 2.55MB/s]
  2%|▏         | 2.33M/125M [00:00&lt;00:45, 2.80MB/s]
  2%|▏         | 2.65M/125M [00:01&lt;00:44, 2.86MB/s]
  2%|▏         | 2.96M/125M [00:01&lt;00:47, 2.67MB/s]
  3%|▎         | 3.30M/125M [00:01&lt;00:44, 2.87MB/s]
  3%|▎         | 3.62M/125M [00:01&lt;00:43, 2.92MB/s]
  3%|▎         | 3.93M/125M [00:01&lt;00:46, 2.70MB/s]
  3%|▎         | 4.27M/125M [00:01&lt;00:43, 2.89MB/s]
  4%|▎         | 4.59M/125M [00:01&lt;00:42, 2.93MB/s]
  4%|▍         | 4.90M/125M [00:01&lt;00:46, 2.72MB/s]
  4%|▍         | 5.23M/125M [00:02&lt;00:43, 2.90MB/s]
  4%|▍         | 5.55M/125M [00:02&lt;00:42, 2.94MB/s]
  5%|▍         | 5.87M/125M [00:02&lt;00:45, 2.73MB/s]
  5%|▍         | 6.20M/125M [00:02&lt;00:42, 2.91MB/s]
  5%|▌         | 6.52M/125M [00:02&lt;00:42, 2.94MB/s]
  5%|▌         | 6.83M/125M [00:02&lt;00:41, 3.01MB/s]
  6%|▌         | 7.12M/125M [00:02&lt;00:44, 2.76MB/s]
  6%|▌         | 7.45M/125M [00:02&lt;00:41, 2.94MB/s]
  6%|▌         | 7.74M/125M [00:02&lt;00:42, 2.89MB/s]
  6%|▋         | 8.05M/125M [00:03&lt;00:45, 2.68MB/s]
  7%|▋         | 8.36M/125M [00:03&lt;00:43, 2.83MB/s]
  7%|▋         | 8.70M/125M [00:03&lt;00:40, 3.01MB/s]
  7%|▋         | 8.99M/125M [00:03&lt;00:41, 2.94MB/s]
  7%|▋         | 9.28M/125M [00:03&lt;00:44, 2.69MB/s]
  8%|▊         | 9.61M/125M [00:03&lt;00:41, 2.89MB/s]
  8%|▊         | 9.91M/125M [00:03&lt;00:41, 2.90MB/s]
  8%|▊         | 10.2M/125M [00:03&lt;00:41, 2.91MB/s]
  8%|▊         | 10.5M/125M [00:04&lt;00:44, 2.68MB/s]
  9%|▊         | 10.8M/125M [00:04&lt;00:40, 2.93MB/s]
  9%|▉         | 11.1M/125M [00:04&lt;00:40, 2.91MB/s]
  9%|▉         | 11.4M/125M [00:04&lt;00:40, 2.91MB/s]
  9%|▉         | 11.7M/125M [00:04&lt;00:44, 2.68MB/s]
 10%|▉         | 12.1M/125M [00:04&lt;00:39, 2.96MB/s]
 10%|▉         | 12.3M/125M [00:04&lt;00:40, 2.92MB/s]
 10%|█         | 12.6M/125M [00:04&lt;00:40, 2.92MB/s]
 10%|█         | 12.9M/125M [00:04&lt;00:43, 2.69MB/s]
 11%|█         | 13.3M/125M [00:05&lt;00:39, 2.97MB/s]
 11%|█         | 13.6M/125M [00:05&lt;00:39, 2.92MB/s]
 11%|█         | 13.9M/125M [00:05&lt;00:43, 2.67MB/s]
 11%|█▏        | 14.2M/125M [00:05&lt;00:39, 2.91MB/s]
 12%|█▏        | 14.5M/125M [00:05&lt;00:40, 2.87MB/s]
 12%|█▏        | 14.8M/125M [00:05&lt;00:39, 2.94MB/s]
 12%|█▏        | 15.1M/125M [00:05&lt;00:41, 2.73MB/s]
 12%|█▏        | 15.4M/125M [00:05&lt;00:39, 2.87MB/s]
 13%|█▎        | 15.7M/125M [00:05&lt;00:39, 2.87MB/s]
 13%|█▎        | 16.0M/125M [00:06&lt;00:38, 2.95MB/s]
 13%|█▎        | 16.3M/125M [00:06&lt;00:41, 2.74MB/s]
 13%|█▎        | 16.6M/125M [00:06&lt;00:39, 2.88MB/s]
 14%|█▎        | 16.9M/125M [00:06&lt;00:39, 2.87MB/s]
 14%|█▍        | 17.2M/125M [00:06&lt;00:38, 2.95MB/s]
 14%|█▍        | 17.5M/125M [00:06&lt;00:41, 2.73MB/s]
 14%|█▍        | 17.9M/125M [00:06&lt;00:38, 2.90MB/s]
 15%|█▍        | 18.1M/125M [00:06&lt;00:39, 2.86MB/s]
 15%|█▍        | 18.5M/125M [00:06&lt;00:37, 2.94MB/s]
 15%|█▌        | 18.7M/125M [00:07&lt;00:40, 2.73MB/s]
 15%|█▌        | 19.1M/125M [00:07&lt;00:38, 2.88MB/s]
 16%|█▌        | 19.4M/125M [00:07&lt;00:38, 2.87MB/s]
 16%|█▌        | 19.7M/125M [00:07&lt;00:37, 2.94MB/s]
 16%|█▌        | 20.0M/125M [00:07&lt;00:40, 2.69MB/s]
 16%|█▋        | 20.3M/125M [00:07&lt;00:36, 2.98MB/s]
 17%|█▋        | 20.6M/125M [00:07&lt;00:37, 2.94MB/s]
 17%|█▋        | 20.9M/125M [00:07&lt;00:41, 2.65MB/s]
 17%|█▋        | 21.3M/125M [00:07&lt;00:36, 2.93MB/s]
 17%|█▋        | 21.5M/125M [00:08&lt;00:37, 2.89MB/s]
 18%|█▊        | 21.8M/125M [00:08&lt;00:36, 2.93MB/s]
 18%|█▊        | 22.1M/125M [00:08&lt;00:39, 2.70MB/s]
 18%|█▊        | 22.5M/125M [00:08&lt;00:36, 2.97MB/s]
 18%|█▊        | 22.8M/125M [00:08&lt;00:36, 2.94MB/s]
 19%|█▊        | 23.1M/125M [00:08&lt;00:40, 2.64MB/s]
 19%|█▉        | 23.5M/125M [00:08&lt;00:35, 2.98MB/s]
 19%|█▉        | 23.8M/125M [00:08&lt;00:36, 2.90MB/s]
 19%|█▉        | 24.0M/125M [00:08&lt;00:39, 2.66MB/s]
 20%|█▉        | 24.4M/125M [00:09&lt;00:35, 2.99MB/s]
 20%|█▉        | 24.7M/125M [00:09&lt;00:35, 2.91MB/s]
 20%|██        | 25.0M/125M [00:09&lt;00:39, 2.65MB/s]
 20%|██        | 25.3M/125M [00:09&lt;00:37, 2.81MB/s]
 21%|██        | 25.7M/125M [00:09&lt;00:35, 2.92MB/s]
 21%|██        | 26.0M/125M [00:09&lt;00:35, 2.95MB/s]
 21%|██        | 26.2M/125M [00:09&lt;00:37, 2.72MB/s]
 21%|██▏       | 26.6M/125M [00:09&lt;00:35, 2.93MB/s]
 22%|██▏       | 26.9M/125M [00:10&lt;00:35, 2.87MB/s]
 22%|██▏       | 27.2M/125M [00:10&lt;00:38, 2.67MB/s]
 22%|██▏       | 27.5M/125M [00:10&lt;00:35, 2.85MB/s]
 22%|██▏       | 27.8M/125M [00:10&lt;00:34, 2.95MB/s]
 23%|██▎       | 28.1M/125M [00:10&lt;00:33, 2.97MB/s]
 23%|██▎       | 28.4M/125M [00:10&lt;00:36, 2.75MB/s]
 23%|██▎       | 28.7M/125M [00:10&lt;00:35, 2.87MB/s]
 23%|██▎       | 29.0M/125M [00:10&lt;00:34, 2.91MB/s]
 24%|██▎       | 29.3M/125M [00:10&lt;00:34, 2.92MB/s]
 24%|██▍       | 29.6M/125M [00:11&lt;00:36, 2.70MB/s]
 24%|██▍       | 30.0M/125M [00:11&lt;00:34, 2.90MB/s]
 24%|██▍       | 30.2M/125M [00:11&lt;00:33, 2.93MB/s]
 25%|██▍       | 30.5M/125M [00:11&lt;00:34, 2.88MB/s]
 25%|██▍       | 30.8M/125M [00:11&lt;00:36, 2.66MB/s]
 25%|██▌       | 31.1M/125M [00:11&lt;00:34, 2.84MB/s]
 25%|██▌       | 31.4M/125M [00:11&lt;00:33, 2.95MB/s]
 25%|██▌       | 31.7M/125M [00:11&lt;00:33, 2.90MB/s]
 26%|██▌       | 32.0M/125M [00:11&lt;00:36, 2.68MB/s]
 26%|██▌       | 32.3M/125M [00:12&lt;00:33, 2.86MB/s]
 26%|██▌       | 32.7M/125M [00:12&lt;00:32, 2.96MB/s]
 26%|██▋       | 32.9M/125M [00:12&lt;00:32, 2.91MB/s]
 27%|██▋       | 33.2M/125M [00:12&lt;00:35, 2.68MB/s]
 27%|██▋       | 33.6M/125M [00:12&lt;00:33, 2.86MB/s]
 27%|██▋       | 33.9M/125M [00:12&lt;00:32, 2.95MB/s]
 27%|██▋       | 34.1M/125M [00:12&lt;00:32, 2.89MB/s]
 28%|██▊       | 34.4M/125M [00:12&lt;00:35, 2.70MB/s]
 28%|██▊       | 34.8M/125M [00:12&lt;00:32, 2.89MB/s]
 28%|██▊       | 35.1M/125M [00:13&lt;00:31, 2.96MB/s]
 28%|██▊       | 35.4M/125M [00:13&lt;00:32, 2.90MB/s]
 29%|██▊       | 35.7M/125M [00:13&lt;00:34, 2.69MB/s]
 29%|██▉       | 36.0M/125M [00:13&lt;00:32, 2.87MB/s]
 29%|██▉       | 36.3M/125M [00:13&lt;00:31, 2.96MB/s]
 29%|██▉       | 36.6M/125M [00:13&lt;00:31, 2.90MB/s]
 30%|██▉       | 36.9M/125M [00:13&lt;00:34, 2.69MB/s]
 30%|██▉       | 37.2M/125M [00:13&lt;00:31, 2.88MB/s]
 30%|███       | 37.5M/125M [00:13&lt;00:30, 2.96MB/s]
 30%|███       | 37.8M/125M [00:14&lt;00:31, 2.91MB/s]
 31%|███       | 38.1M/125M [00:14&lt;00:33, 2.69MB/s]
 31%|███       | 38.4M/125M [00:14&lt;00:31, 2.88MB/s]
 31%|███       | 38.7M/125M [00:14&lt;00:30, 2.93MB/s]
 31%|███▏      | 39.0M/125M [00:14&lt;00:30, 2.91MB/s]
 32%|███▏      | 39.3M/125M [00:14&lt;00:33, 2.69MB/s]
 32%|███▏      | 39.6M/125M [00:14&lt;00:30, 2.88MB/s]
 32%|███▏      | 39.9M/125M [00:14&lt;00:30, 2.92MB/s]
 32%|███▏      | 40.2M/125M [00:14&lt;00:30, 2.92MB/s]
 33%|███▎      | 40.5M/125M [00:15&lt;00:32, 2.70MB/s]
 33%|███▎      | 40.8M/125M [00:15&lt;00:30, 2.89MB/s]
 33%|███▎      | 41.1M/125M [00:15&lt;00:29, 2.93MB/s]
 33%|███▎      | 41.4M/125M [00:15&lt;00:29, 2.92MB/s]
 33%|███▎      | 41.7M/125M [00:15&lt;00:32, 2.70MB/s]
 34%|███▍      | 42.0M/125M [00:15&lt;00:29, 2.89MB/s]
 34%|███▍      | 42.3M/125M [00:15&lt;00:29, 2.97MB/s]
 34%|███▍      | 42.6M/125M [00:15&lt;00:29, 2.90MB/s]
 34%|███▍      | 42.9M/125M [00:15&lt;00:31, 2.68MB/s]
 35%|███▍      | 43.3M/125M [00:16&lt;00:29, 2.88MB/s]
 35%|███▍      | 43.6M/125M [00:16&lt;00:28, 2.93MB/s]
 35%|███▌      | 43.9M/125M [00:16&lt;00:28, 2.94MB/s]
 35%|███▌      | 44.1M/125M [00:16&lt;00:31, 2.70MB/s]
 36%|███▌      | 44.5M/125M [00:16&lt;00:29, 2.88MB/s]
 36%|███▌      | 44.8M/125M [00:16&lt;00:28, 2.93MB/s]
 36%|███▌      | 45.1M/125M [00:16&lt;00:28, 2.94MB/s]
 36%|███▋      | 45.4M/125M [00:16&lt;00:30, 2.70MB/s]
 37%|███▋      | 45.7M/125M [00:16&lt;00:28, 2.88MB/s]
 37%|███▋      | 46.0M/125M [00:17&lt;00:28, 2.93MB/s]
 37%|███▋      | 46.3M/125M [00:17&lt;00:28, 2.92MB/s]
 37%|███▋      | 46.6M/125M [00:17&lt;00:30, 2.70MB/s]
 38%|███▊      | 46.9M/125M [00:17&lt;00:28, 2.88MB/s]
 38%|███▊      | 47.2M/125M [00:17&lt;00:27, 2.93MB/s]
 38%|███▊      | 47.5M/125M [00:17&lt;00:27, 2.93MB/s]
 38%|███▊      | 47.8M/125M [00:17&lt;00:29, 2.70MB/s]
 39%|███▊      | 48.1M/125M [00:17&lt;00:27, 2.88MB/s]
 39%|███▉      | 48.4M/125M [00:17&lt;00:27, 2.93MB/s]
 39%|███▉      | 48.7M/125M [00:18&lt;00:27, 2.93MB/s]
 39%|███▉      | 49.0M/125M [00:18&lt;00:29, 2.70MB/s]
 40%|███▉      | 49.3M/125M [00:18&lt;00:27, 2.88MB/s]
 40%|███▉      | 49.6M/125M [00:18&lt;00:26, 2.93MB/s]
 40%|████      | 49.9M/125M [00:18&lt;00:26, 2.91MB/s]
 40%|████      | 50.2M/125M [00:18&lt;00:29, 2.67MB/s]
 41%|████      | 50.5M/125M [00:18&lt;00:26, 2.88MB/s]
 41%|████      | 50.8M/125M [00:18&lt;00:26, 2.95MB/s]
 41%|████      | 51.1M/125M [00:18&lt;00:26, 2.92MB/s]
 41%|████▏     | 51.4M/125M [00:19&lt;00:28, 2.67MB/s]
 42%|████▏     | 51.7M/125M [00:19&lt;00:26, 2.91MB/s]
 42%|████▏     | 52.0M/125M [00:19&lt;00:25, 2.95MB/s]
 42%|████▏     | 52.3M/125M [00:19&lt;00:26, 2.91MB/s]
 42%|████▏     | 52.6M/125M [00:19&lt;00:28, 2.67MB/s]
 43%|████▎     | 52.9M/125M [00:19&lt;00:26, 2.85MB/s]
 43%|████▎     | 53.2M/125M [00:19&lt;00:25, 2.96MB/s]
 43%|████▎     | 53.5M/125M [00:19&lt;00:25, 2.91MB/s]
 43%|████▎     | 53.8M/125M [00:19&lt;00:27, 2.69MB/s]
 43%|████▎     | 54.1M/125M [00:20&lt;00:25, 2.86MB/s]
 44%|████▎     | 54.5M/125M [00:20&lt;00:24, 2.97MB/s]
 44%|████▍     | 54.8M/125M [00:20&lt;00:25, 2.89MB/s]
 44%|████▍     | 55.0M/125M [00:20&lt;00:27, 2.69MB/s]
 44%|████▍     | 55.4M/125M [00:20&lt;00:25, 2.87MB/s]
 45%|████▍     | 55.7M/125M [00:20&lt;00:24, 2.97MB/s]
 45%|████▍     | 56.0M/125M [00:20&lt;00:24, 2.90MB/s]
 45%|████▌     | 56.2M/125M [00:20&lt;00:26, 2.69MB/s]
 45%|████▌     | 56.6M/125M [00:20&lt;00:24, 2.87MB/s]
 46%|████▌     | 56.9M/125M [00:21&lt;00:23, 2.98MB/s]
 46%|████▌     | 57.2M/125M [00:21&lt;00:24, 2.90MB/s]
 46%|████▌     | 57.5M/125M [00:21&lt;00:26, 2.68MB/s]
 46%|████▋     | 57.8M/125M [00:21&lt;00:24, 2.88MB/s]
 47%|████▋     | 58.1M/125M [00:21&lt;00:23, 2.98MB/s]
 47%|████▋     | 58.4M/125M [00:21&lt;00:23, 2.90MB/s]
 47%|████▋     | 58.7M/125M [00:21&lt;00:25, 2.68MB/s]
 47%|████▋     | 59.0M/125M [00:21&lt;00:23, 2.88MB/s]
 48%|████▊     | 59.3M/125M [00:21&lt;00:22, 2.99MB/s]
 48%|████▊     | 59.6M/125M [00:22&lt;00:23, 2.92MB/s]
 48%|████▊     | 59.9M/125M [00:22&lt;00:25, 2.71MB/s]
 48%|████▊     | 60.2M/125M [00:22&lt;00:23, 2.91MB/s]
 49%|████▊     | 60.5M/125M [00:22&lt;00:22, 2.92MB/s]
 49%|████▉     | 60.8M/125M [00:22&lt;00:22, 2.92MB/s]
 49%|████▉     | 61.1M/125M [00:22&lt;00:24, 2.71MB/s]
 49%|████▉     | 61.4M/125M [00:22&lt;00:22, 2.90MB/s]
 50%|████▉     | 61.7M/125M [00:22&lt;00:22, 2.92MB/s]
 50%|████▉     | 62.0M/125M [00:22&lt;00:22, 2.93MB/s]
 50%|█████     | 62.3M/125M [00:23&lt;00:24, 2.71MB/s]
 50%|█████     | 62.6M/125M [00:23&lt;00:22, 2.90MB/s]
 51%|█████     | 63.0M/125M [00:23&lt;00:22, 2.92MB/s]
 51%|█████     | 63.2M/125M [00:23&lt;00:21, 2.92MB/s]
 51%|█████     | 63.5M/125M [00:23&lt;00:23, 2.70MB/s]
 51%|█████▏    | 63.9M/125M [00:23&lt;00:21, 2.95MB/s]
 52%|█████▏    | 64.2M/125M [00:23&lt;00:21, 2.90MB/s]
 52%|█████▏    | 64.4M/125M [00:23&lt;00:21, 2.89MB/s]
 52%|█████▏    | 64.7M/125M [00:23&lt;00:23, 2.67MB/s]
 52%|█████▏    | 65.1M/125M [00:24&lt;00:21, 2.91MB/s]
 52%|█████▏    | 65.4M/125M [00:24&lt;00:21, 2.92MB/s]
 53%|█████▎    | 65.7M/125M [00:24&lt;00:21, 2.93MB/s]
 53%|█████▎    | 66.0M/125M [00:24&lt;00:22, 2.70MB/s]
 53%|█████▎    | 66.3M/125M [00:24&lt;00:20, 2.96MB/s]
 53%|█████▎    | 66.6M/125M [00:24&lt;00:20, 2.92MB/s]
 54%|█████▎    | 66.9M/125M [00:24&lt;00:20, 2.93MB/s]
 54%|█████▍    | 67.2M/125M [00:24&lt;00:22, 2.70MB/s]
 54%|█████▍    | 67.5M/125M [00:24&lt;00:20, 2.94MB/s]
 54%|█████▍    | 67.8M/125M [00:25&lt;00:20, 2.91MB/s]
 55%|█████▍    | 68.1M/125M [00:25&lt;00:20, 2.90MB/s]
 55%|█████▍    | 68.4M/125M [00:25&lt;00:21, 2.69MB/s]
 55%|█████▌    | 68.7M/125M [00:25&lt;00:19, 2.93MB/s]
 55%|█████▌    | 69.0M/125M [00:25&lt;00:20, 2.90MB/s]
 56%|█████▌    | 69.3M/125M [00:25&lt;00:20, 2.87MB/s]
 56%|█████▌    | 69.6M/125M [00:25&lt;00:21, 2.67MB/s]
 56%|█████▌    | 69.9M/125M [00:25&lt;00:19, 2.91MB/s]
 56%|█████▋    | 70.2M/125M [00:25&lt;00:19, 2.93MB/s]
 57%|█████▋    | 70.5M/125M [00:26&lt;00:19, 2.92MB/s]
 57%|█████▋    | 70.8M/125M [00:26&lt;00:20, 2.69MB/s]
 57%|█████▋    | 71.1M/125M [00:26&lt;00:19, 2.87MB/s]
 57%|█████▋    | 71.4M/125M [00:26&lt;00:18, 2.94MB/s]
 58%|█████▊    | 71.7M/125M [00:26&lt;00:18, 2.92MB/s]
 58%|█████▊    | 72.0M/125M [00:26&lt;00:20, 2.68MB/s]
 58%|█████▊    | 72.3M/125M [00:26&lt;00:19, 2.84MB/s]
 58%|█████▊    | 72.6M/125M [00:26&lt;00:18, 2.95MB/s]
 59%|█████▊    | 72.9M/125M [00:26&lt;00:18, 2.94MB/s]
 59%|█████▉    | 73.2M/125M [00:27&lt;00:19, 2.70MB/s]
 59%|█████▉    | 73.5M/125M [00:27&lt;00:18, 2.86MB/s]
 59%|█████▉    | 73.9M/125M [00:27&lt;00:18, 2.95MB/s]
 60%|█████▉    | 74.1M/125M [00:27&lt;00:18, 2.91MB/s]
 60%|█████▉    | 74.4M/125M [00:27&lt;00:19, 2.69MB/s]
 60%|██████    | 74.8M/125M [00:27&lt;00:18, 2.87MB/s]
 60%|██████    | 75.1M/125M [00:27&lt;00:17, 2.95MB/s]
 61%|██████    | 75.4M/125M [00:27&lt;00:17, 2.92MB/s]
 61%|██████    | 75.6M/125M [00:27&lt;00:19, 2.69MB/s]
 61%|██████    | 75.9M/125M [00:28&lt;00:17, 2.84MB/s]
 61%|██████    | 76.3M/125M [00:28&lt;00:17, 2.96MB/s]
 61%|██████▏   | 76.6M/125M [00:28&lt;00:17, 2.93MB/s]
 62%|██████▏   | 76.9M/125M [00:28&lt;00:18, 2.70MB/s]
 62%|██████▏   | 77.2M/125M [00:28&lt;00:17, 2.87MB/s]
 62%|██████▏   | 77.5M/125M [00:28&lt;00:16, 2.94MB/s]
 62%|██████▏   | 77.8M/125M [00:28&lt;00:16, 2.92MB/s]
 63%|██████▎   | 78.1M/125M [00:28&lt;00:18, 2.70MB/s]
 63%|██████▎   | 78.4M/125M [00:28&lt;00:16, 2.92MB/s]
 63%|██████▎   | 78.7M/125M [00:29&lt;00:16, 2.93MB/s]
 63%|██████▎   | 79.0M/125M [00:29&lt;00:16, 2.91MB/s]
 64%|██████▎   | 79.3M/125M [00:29&lt;00:17, 2.68MB/s]
 64%|██████▍   | 79.5M/125M [00:29&lt;00:17, 2.70MB/s]
 64%|██████▍   | 79.8M/125M [00:29&lt;00:16, 2.85MB/s]
 64%|██████▍   | 80.2M/125M [00:29&lt;00:15, 2.97MB/s]
 65%|██████▍   | 80.5M/125M [00:29&lt;00:16, 2.74MB/s]
 65%|██████▍   | 80.7M/125M [00:29&lt;00:16, 2.74MB/s]
 65%|██████▌   | 81.0M/125M [00:29&lt;00:15, 2.85MB/s]
 65%|██████▌   | 81.4M/125M [00:30&lt;00:14, 3.03MB/s]
 66%|██████▌   | 81.7M/125M [00:30&lt;00:16, 2.74MB/s]
 66%|██████▌   | 81.9M/125M [00:30&lt;00:16, 2.76MB/s]
 66%|██████▌   | 82.2M/125M [00:30&lt;00:15, 2.87MB/s]
 66%|██████▋   | 82.6M/125M [00:30&lt;00:14, 3.04MB/s]
 67%|██████▋   | 82.9M/125M [00:30&lt;00:15, 2.75MB/s]
 67%|██████▋   | 83.2M/125M [00:30&lt;00:15, 2.77MB/s]
 67%|██████▋   | 83.5M/125M [00:30&lt;00:14, 2.87MB/s]
 67%|██████▋   | 83.8M/125M [00:30&lt;00:14, 3.04MB/s]
 68%|██████▊   | 84.1M/125M [00:31&lt;00:15, 2.75MB/s]
 68%|██████▊   | 84.4M/125M [00:31&lt;00:15, 2.77MB/s]
 68%|██████▊   | 84.7M/125M [00:31&lt;00:14, 2.87MB/s]
 68%|██████▊   | 85.0M/125M [00:31&lt;00:13, 3.04MB/s]
 69%|██████▊   | 85.3M/125M [00:31&lt;00:14, 2.76MB/s]
 69%|██████▊   | 85.6M/125M [00:31&lt;00:14, 2.76MB/s]
 69%|██████▉   | 85.9M/125M [00:31&lt;00:14, 2.87MB/s]
 69%|██████▉   | 86.2M/125M [00:31&lt;00:13, 3.05MB/s]
 69%|██████▉   | 86.5M/125M [00:31&lt;00:14, 2.76MB/s]
 70%|██████▉   | 86.8M/125M [00:32&lt;00:14, 2.77MB/s]
 70%|██████▉   | 87.1M/125M [00:32&lt;00:13, 2.86MB/s]
 70%|███████   | 87.4M/125M [00:32&lt;00:12, 3.07MB/s]
 70%|███████   | 87.7M/125M [00:32&lt;00:13, 2.78MB/s]
 71%|███████   | 88.0M/125M [00:32&lt;00:13, 2.77MB/s]
 71%|███████   | 88.3M/125M [00:32&lt;00:13, 2.85MB/s]
 71%|███████   | 88.7M/125M [00:32&lt;00:12, 3.03MB/s]
 71%|███████▏  | 89.0M/125M [00:32&lt;00:13, 2.80MB/s]
 72%|███████▏  | 89.2M/125M [00:32&lt;00:13, 2.78MB/s]
 72%|███████▏  | 89.5M/125M [00:33&lt;00:12, 2.85MB/s]
 72%|███████▏  | 89.8M/125M [00:33&lt;00:12, 2.99MB/s]
 72%|███████▏  | 90.1M/125M [00:33&lt;00:13, 2.76MB/s]
 73%|███████▎  | 90.4M/125M [00:33&lt;00:12, 2.77MB/s]
 73%|███████▎  | 90.7M/125M [00:33&lt;00:12, 2.87MB/s]
 73%|███████▎  | 91.0M/125M [00:33&lt;00:11, 2.99MB/s]
 73%|███████▎  | 91.3M/125M [00:33&lt;00:11, 3.05MB/s]
 74%|███████▎  | 91.6M/125M [00:33&lt;00:12, 2.73MB/s]
 74%|███████▍  | 91.9M/125M [00:33&lt;00:12, 2.82MB/s]
 74%|███████▍  | 92.2M/125M [00:34&lt;00:11, 2.90MB/s]
 74%|███████▍  | 92.6M/125M [00:34&lt;00:11, 3.03MB/s]
 75%|███████▍  | 92.9M/125M [00:34&lt;00:12, 2.72MB/s]
 75%|███████▍  | 93.1M/125M [00:34&lt;00:11, 2.82MB/s]
 75%|███████▌  | 93.4M/125M [00:34&lt;00:11, 2.84MB/s]
 75%|███████▌  | 93.7M/125M [00:34&lt;00:10, 2.96MB/s]
 76%|███████▌  | 94.0M/125M [00:34&lt;00:11, 2.76MB/s]
 76%|███████▌  | 94.3M/125M [00:34&lt;00:11, 2.76MB/s]
 76%|███████▌  | 94.6M/125M [00:34&lt;00:10, 2.85MB/s]
 76%|███████▌  | 94.9M/125M [00:35&lt;00:10, 2.87MB/s]
 76%|███████▋  | 95.2M/125M [00:35&lt;00:10, 2.95MB/s]
 77%|███████▋  | 95.5M/125M [00:35&lt;00:11, 2.74MB/s]
 77%|███████▋  | 95.8M/125M [00:35&lt;00:10, 2.76MB/s]
 77%|███████▋  | 96.0M/125M [00:35&lt;00:10, 2.83MB/s]
 77%|███████▋  | 96.3M/125M [00:35&lt;00:10, 2.90MB/s]
 78%|███████▊  | 96.6M/125M [00:35&lt;00:10, 2.92MB/s]
 78%|███████▊  | 96.9M/125M [00:35&lt;00:10, 2.78MB/s]
 78%|███████▊  | 97.2M/125M [00:35&lt;00:10, 2.77MB/s]
 78%|███████▊  | 97.5M/125M [00:35&lt;00:09, 2.86MB/s]
 79%|███████▊  | 97.8M/125M [00:36&lt;00:09, 2.85MB/s]
 79%|███████▉  | 98.1M/125M [00:36&lt;00:09, 2.90MB/s]
 79%|███████▉  | 98.4M/125M [00:36&lt;00:09, 2.95MB/s]
 79%|███████▉  | 98.7M/125M [00:36&lt;00:09, 2.75MB/s]
 79%|███████▉  | 99.0M/125M [00:36&lt;00:09, 2.85MB/s]
 80%|███████▉  | 99.2M/125M [00:36&lt;00:09, 2.81MB/s]
 80%|███████▉  | 99.5M/125M [00:36&lt;00:09, 2.86MB/s]
 80%|████████  | 99.8M/125M [00:36&lt;00:09, 2.87MB/s]
 80%|████████  | 100M/125M [00:36&lt;00:09, 2.81MB/s]
 81%|████████  | 100M/125M [00:37&lt;00:09, 2.78MB/s]
 81%|████████  | 101M/125M [00:37&lt;00:08, 2.86MB/s]
 81%|████████  | 101M/125M [00:37&lt;00:08, 2.83MB/s]
 81%|████████▏ | 101M/125M [00:37&lt;00:08, 2.91MB/s]
 82%|████████▏ | 102M/125M [00:37&lt;00:08, 2.81MB/s]
 82%|████████▏ | 102M/125M [00:37&lt;00:08, 2.82MB/s]
 82%|████████▏ | 102M/125M [00:37&lt;00:08, 2.82MB/s]
 82%|████████▏ | 102M/125M [00:37&lt;00:08, 2.86MB/s]
 82%|████████▏ | 103M/125M [00:37&lt;00:08, 2.84MB/s]
 83%|████████▎ | 103M/125M [00:37&lt;00:07, 2.88MB/s]
 83%|████████▎ | 103M/125M [00:38&lt;00:07, 2.84MB/s]
 83%|████████▎ | 104M/125M [00:38&lt;00:07, 2.84MB/s]
 83%|████████▎ | 104M/125M [00:38&lt;00:07, 2.84MB/s]
 84%|████████▎ | 104M/125M [00:38&lt;00:07, 2.85MB/s]
 84%|████████▍ | 104M/125M [00:38&lt;00:07, 2.83MB/s]
 84%|████████▍ | 105M/125M [00:38&lt;00:07, 2.89MB/s]
 84%|████████▍ | 105M/125M [00:38&lt;00:07, 2.85MB/s]
 84%|████████▍ | 105M/125M [00:38&lt;00:07, 2.85MB/s]
 85%|████████▍ | 105M/125M [00:38&lt;00:07, 2.78MB/s]
 85%|████████▍ | 106M/125M [00:39&lt;00:06, 2.88MB/s]
 85%|████████▌ | 106M/125M [00:39&lt;00:06, 2.92MB/s]
 85%|████████▌ | 106M/125M [00:39&lt;00:06, 2.91MB/s]
 86%|████████▌ | 107M/125M [00:39&lt;00:06, 2.85MB/s]
 86%|████████▌ | 107M/125M [00:39&lt;00:06, 2.83MB/s]
 86%|████████▌ | 107M/125M [00:39&lt;00:06, 2.79MB/s]
 86%|████████▋ | 107M/125M [00:39&lt;00:06, 2.86MB/s]
 87%|████████▋ | 108M/125M [00:39&lt;00:06, 2.91MB/s]
 87%|████████▋ | 108M/125M [00:39&lt;00:05, 2.90MB/s]
 87%|████████▋ | 108M/125M [00:39&lt;00:05, 2.84MB/s]
 87%|████████▋ | 109M/125M [00:40&lt;00:05, 2.82MB/s]
 87%|████████▋ | 109M/125M [00:40&lt;00:05, 2.79MB/s]
 88%|████████▊ | 109M/125M [00:40&lt;00:05, 2.87MB/s]
 88%|████████▊ | 109M/125M [00:40&lt;00:05, 2.91MB/s]
 88%|████████▊ | 110M/125M [00:40&lt;00:05, 2.90MB/s]
 88%|████████▊ | 110M/125M [00:40&lt;00:05, 2.83MB/s]
 89%|████████▊ | 110M/125M [00:40&lt;00:05, 2.82MB/s]
 89%|████████▉ | 111M/125M [00:40&lt;00:05, 2.79MB/s]
 89%|████████▉ | 111M/125M [00:40&lt;00:05, 2.83MB/s]
 89%|████████▉ | 111M/125M [00:40&lt;00:04, 2.92MB/s]
 90%|████████▉ | 111M/125M [00:41&lt;00:04, 2.85MB/s]
 90%|████████▉ | 112M/125M [00:41&lt;00:04, 2.84MB/s]
 90%|████████▉ | 112M/125M [00:41&lt;00:04, 2.79MB/s]
 90%|█████████ | 112M/125M [00:41&lt;00:04, 2.85MB/s]
 90%|█████████ | 113M/125M [00:41&lt;00:04, 2.93MB/s]
 91%|█████████ | 113M/125M [00:41&lt;00:04, 2.86MB/s]
 91%|█████████ | 113M/125M [00:41&lt;00:04, 2.84MB/s]
 91%|█████████ | 113M/125M [00:41&lt;00:04, 2.80MB/s]
 91%|█████████▏| 114M/125M [00:41&lt;00:03, 2.89MB/s]
 92%|█████████▏| 114M/125M [00:42&lt;00:03, 2.87MB/s]
 92%|█████████▏| 114M/125M [00:42&lt;00:03, 2.93MB/s]
 92%|█████████▏| 115M/125M [00:42&lt;00:03, 2.84MB/s]
 92%|█████████▏| 115M/125M [00:42&lt;00:03, 2.84MB/s]
 92%|█████████▏| 115M/125M [00:42&lt;00:03, 2.80MB/s]
 93%|█████████▎| 115M/125M [00:42&lt;00:03, 2.84MB/s]
 93%|█████████▎| 116M/125M [00:42&lt;00:03, 2.92MB/s]
 93%|█████████▎| 116M/125M [00:42&lt;00:03, 2.84MB/s]
 93%|█████████▎| 116M/125M [00:42&lt;00:03, 2.85MB/s]
 94%|█████████▎| 117M/125M [00:43&lt;00:02, 2.83MB/s]
 94%|█████████▍| 117M/125M [00:43&lt;00:02, 2.89MB/s]
 94%|█████████▍| 117M/125M [00:43&lt;00:02, 2.87MB/s]
 94%|█████████▍| 117M/125M [00:43&lt;00:02, 2.92MB/s]
 95%|█████████▍| 118M/125M [00:43&lt;00:02, 2.85MB/s]
 95%|█████████▍| 118M/125M [00:43&lt;00:02, 2.83MB/s]
 95%|█████████▌| 118M/125M [00:43&lt;00:02, 2.82MB/s]
 95%|█████████▌| 119M/125M [00:43&lt;00:02, 2.87MB/s]
 95%|█████████▌| 119M/125M [00:43&lt;00:02, 2.84MB/s]
 96%|█████████▌| 119M/125M [00:43&lt;00:01, 2.92MB/s]
 96%|█████████▌| 119M/125M [00:44&lt;00:01, 2.85MB/s]
 96%|█████████▌| 120M/125M [00:44&lt;00:01, 2.83MB/s]
 96%|█████████▋| 120M/125M [00:44&lt;00:01, 2.82MB/s]
 97%|█████████▋| 120M/125M [00:44&lt;00:01, 2.88MB/s]
 97%|█████████▋| 121M/125M [00:44&lt;00:01, 2.84MB/s]
 97%|█████████▋| 121M/125M [00:44&lt;00:01, 2.91MB/s]
 97%|█████████▋| 121M/125M [00:44&lt;00:01, 2.86MB/s]
 98%|█████████▊| 121M/125M [00:44&lt;00:01, 2.84MB/s]
 98%|█████████▊| 122M/125M [00:44&lt;00:01, 2.83MB/s]
 98%|█████████▊| 122M/125M [00:44&lt;00:00, 2.88MB/s]
 98%|█████████▊| 122M/125M [00:45&lt;00:00, 2.83MB/s]
 98%|█████████▊| 123M/125M [00:45&lt;00:00, 2.91MB/s]
 99%|█████████▊| 123M/125M [00:45&lt;00:00, 2.86MB/s]
 99%|█████████▉| 123M/125M [00:45&lt;00:00, 2.84MB/s]
 99%|█████████▉| 123M/125M [00:45&lt;00:00, 2.82MB/s]
 99%|█████████▉| 124M/125M [00:45&lt;00:00, 2.81MB/s]
100%|█████████▉| 124M/125M [00:45&lt;00:00, 2.89MB/s]
100%|█████████▉| 124M/125M [00:45&lt;00:00, 2.84MB/s]
100%|██████████| 125M/125M [00:45&lt;00:00, 2.85MB/s]
</pre></div>
</div>
</section>
<section id="evaluate-the-model-on-the-problem">
<h2>Evaluate the model on the problem.<a class="headerlink" href="#evaluate-the-model-on-the-problem" title="Link to this heading"></a></h2>
<p>The test function evaluates the model on the test dataset and computes the metrics.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">save_folder</span></a> <span class="o">=</span> <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">RESULTS_DIR</span></a> <span class="o">/</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">method</span></a> <span class="o">/</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">operation</span></a> <span class="o">/</span> <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataset_name</span></a>
<a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">wandb_vis</span></a> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># plot curves and images in Weight&amp;Bias.</span>
<a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plot_metrics</span></a> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># plot metrics. Metrics are saved in save_folder.</span>
<a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plot_images</span></a> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># plot images. Images are saved in save_folder.</span>

<a href="https://pytorch.org/docs/2.0/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataloader</span></a> <span class="o">=</span> <a href="https://pytorch.org/docs/2.0/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class"><span class="n">DataLoader</span></a><span class="p">(</span>
    <span class="n">dataset</span><span class="p">,</span> <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">batch_size</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">batch_size</span></a><span class="p">,</span> <a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">num_workers</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#int" title="builtins.int" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">num_workers</span></a><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">test_dataloader</span><span class="o">=</span><a href="https://pytorch.org/docs/2.0/data.html#torch.utils.data.DataLoader" title="torch.utils.data.DataLoader" class="sphx-glr-backref-module-torch-utils-data sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">dataloader</span></a><span class="p">,</span>
    <span class="n">physics</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/stdtypes.html#str" title="builtins.str" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">device</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plot_images</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plot_images</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">save_folder</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/pathlib.html#pathlib.PosixPath" title="pathlib.PosixPath" class="sphx-glr-backref-module-pathlib sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">save_folder</span></a><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plot_metrics</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">plot_metrics</span></a><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">wandb_vis</span></a><span class="o">=</span><a href="https://docs.python.org/3.4/library/functions.html#bool" title="builtins.bool" class="sphx-glr-backref-module-builtins sphx-glr-backref-type-py-class sphx-glr-backref-instance"><span class="n">wandb_vis</span></a><span class="p">,</span>
    <span class="n">plot_only_first_batch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># By default only the first batch is plotted.</span>
<span class="p">)</span>
</pre></div>
</div>
<ul class="sphx-glr-horizontal">
<li><img src="../../_images/sphx_glr_demo_PnP_DPIR_deblur_001.png" srcset="../../_images/sphx_glr_demo_PnP_DPIR_deblur_001.png" alt="Input, Linear, Recons., GT" class = "sphx-glr-multi-img"/></li>
<li><img src="../../_images/sphx_glr_demo_PnP_DPIR_deblur_002.png" srcset="../../_images/sphx_glr_demo_PnP_DPIR_deblur_002.png" alt="$PSNR(x_k)$, Residual $\frac{||x_{k+1} - x_k||}{||x_k||}$" class = "sphx-glr-multi-img"/></li>
</ul>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Processing data of operator 1 out of 1

  0%|          | 0/1 [00:00&lt;?, ?it/s]
100%|██████████| 1/1 [00:05&lt;00:00,  5.24s/it]
100%|██████████| 1/1 [00:05&lt;00:00,  5.24s/it]
Test PSNR: Linear rec.: 16.97+-0.00 dB | Model: 30.31+-0.00 dB.

(30.305654525756836, 0.0, 16.96754264831543, 0.0)
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (1 minutes 28.270 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plug-and-play-demo-pnp-dpir-deblur-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/66d5a51225f2bbe270c25718606aa356/demo_PnP_DPIR_deblur.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">demo_PnP_DPIR_deblur.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../../_downloads/27365b4f1c4bfbe1cc5e089da624baf3/demo_PnP_DPIR_deblur.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">demo_PnP_DPIR_deblur.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="demo_vanilla_PnP.html" class="btn btn-neutral float-left" title="Vanilla PnP for computed tomography (CT)." accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="demo_RED_GSPnP_SR.html" class="btn btn-neutral float-right" title="Regularization by Denoising (RED) for Super-Resolution." accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, DeepInv.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NSEKFKYSGR"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-NSEKFKYSGR', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>